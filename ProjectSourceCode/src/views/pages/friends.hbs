{{> header}}
<h1>Your Constellation of Friends</h1>

<div class="container mt-4">
  <h2>Your Friends</h2>
  <div id="friendsList" class="mt-3">
    <!-- Friends will be displayed here -->
  </div>
</div>

<script>
  // Initialize friends array from server data
  let friends = [];
  try {
    const rawFriendsData = '{{{ friends }}}'; // Server-passed JSON data
    if (rawFriendsData && rawFriendsData !== 'undefined') {
      friends = JSON.parse(rawFriendsData); // Parse the JSON string into an array
    }
  } catch (e) {
    console.error('Error parsing friends data:', e);
  }

  // Run after DOM content is loaded
  document.addEventListener('DOMContentLoaded', function () {
    loadFriends();
  });

  // Function to load and display friends
  function loadFriends() {
    const friendsList = document.getElementById('friendsList');
    friendsList.innerHTML = ''; // Clear the container first

    if (!friends || friends.length === 0) {
      friendsList.innerHTML = '<p>No friends found. Start adding to your constellation!</p>';
      return;
    }

    // Create a list to display friends
    const list = document.createElement('ul');
    list.className = 'list-group';

    friends.forEach(friend => {
      const listItem = document.createElement('li');
      listItem.className = 'list-group-item';
      listItem.textContent = `Name: ${friend.username} --- Birthday: ${friend.birthday.substring(0, 10)}`;
      list.appendChild(listItem);
    });

    friendsList.appendChild(list);
  }
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{{> footer}}
